@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>

@{
 ViewBag.Title = "Inicio";
 Layout = "/Views/Shared/_Layout.cshtml";
 var isAuth = User?.Identity?.IsAuthenticated ?? false;
 var nombre = User?.Identity?.Name ?? "";
 var isAdmin = User?.IsInRole("Administrador") == true;
 var isDocente = User?.IsInRole("Docente") == true;
 var isCoordinador = User?.IsInRole("Coordinador") == true;
 var isEstudiante = User?.IsInRole("Estudiante") == true;
}
<div class="p-5 bg-light rounded-3">
 @if (isAuth)
 {
 <h1 class="display-5">Bienvenido @nombre</h1>
 <p class="lead">Este es su Sistema de Gestión Escolar.</p>
 <hr />
 <h5>Accesos rápidos</h5>
 <div class="row g-3 mt-2">
 @* Cursos: mostrar sólo para Docente, Administrador o usuarios con permiso, pero no a Estudiantes *@
 @if ((isDocente || User.HasClaim("permiso","Cursos.Ver") || isAdmin) && !isEstudiante)
 {
 <div class="col-sm-6 col-md-3">
 <a class="btn btn-outline-primary w-100" href="/Cursos">Cursos</a>
 </div>
 }
 @* Historial: docentes/coordinadores/admin ven el módulo general; estudiantes ven "Mi Historial" *@
 @if (isDocente || isCoordinador || isAdmin)
 {
 <div class="col-sm-6 col-md-3">
 <a class="btn btn-outline-secondary w-100" href="/Historial">Historial Académico</a>
 </div>
 }
 else if (isEstudiante)
 {
 <div class="col-sm-6 col-md-3">
 <a class="btn btn-outline-secondary w-100" href="/MiHistorial">Mi Historial</a>
 </div>
 }
 @* Usuarios (gestion) *@
 @if (User?.HasClaim("permiso","Usuarios.Gestion") ?? false)
 {
 <div class="col-sm-6 col-md-3">
 <a class="btn btn-outline-success w-100" href="/Usuarios">Usuarios</a>
 </div>
 }
 @* Bitácora *@
 @if (User?.HasClaim("permiso","Bitacora.Ver") ?? false)
 {
 <div class="col-sm-6 col-md-3">
 <a class="btn btn-outline-dark w-100" href="/Bitacora">Bitácora</a>
 </div>
 }
 @* Estadísticas: Docente, Coordinador, Administrador *@
 @if (isDocente || isCoordinador || isAdmin)
 {
 <div class="col-md-3">
 <div class="card p-3">
 <h5>Estadísticas</h5>
 <p>Ver estadísticas por curso y cuatrimestre</p>
 <a class="btn btn-sm btn-primary" href="/Estadisticas">Ir a Estadísticas</a>
 </div>
 </div>
 }
 @* Matriculación: solo admin o usuario con permiso Cursos.Crear *@
 @if (User.HasClaim("permiso","Cursos.Crear") || isAdmin)
 {
 <div class="col-md-3">
 <div class="card p-3">
 <h5>Matriculación</h5>
 <p>Matricular estudiantes</p>
 <a class="btn btn-sm btn-primary" href="/Matriculas/Crear">Matricular</a>
 </div>
 </div>
 }
 @* Enlace editar perfil (siempre visible para autenticados) *@
 <div class="col-sm-6 col-md-3">
 <a class="btn btn-outline-secondary w-100" href="/Usuarios/Editar/@(User?.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value)">Mi Perfil</a>
 </div>
 </div>
 }
 else
 {
 <h1 class="display-5">Sistema de Gestión Escolar</h1>
 <p class="lead">Por favor inicie sesión para acceder a sus funcionalidades.</p>
 <a class="btn btn-primary" href="/Auth/Login">Iniciar Sesión</a>
 }
</div>
