@{
    ViewData["Title"] = "Inicio";
    ViewBag.Title = "Inicio";
    Layout = "/Views/Shared/_Layout.cshtml";
    var isAuth = User?.Identity?.IsAuthenticated ?? false;
    var nombre = User?.Identity?.Name ?? "";
    var userId = User?.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value ?? string.Empty;
    var isAdmin = User?.IsInRole("Administrador") == true;
    var isDocente = User?.IsInRole("Docente") == true;
    var isCoordinador = User?.IsInRole("Coordinador") == true;
    var isEstudiante = User?.IsInRole("Estudiante") == true;
}

<div class="text-center">
    <h1 class="display-4">Sistema de Gestión Escolar</h1>
    <p>Manual de usuario: <a href="https://learn.microsoft.com/aspnet/core">consultar documentación</a>.</p>
</div>

<div class="p-5 bg-light rounded-3">
    @if (isAuth)
    {
        <h1 class="display-5">Bienvenido @nombre</h1>
        <p class="lead">Este es su Sistema de Gestión Escolar.</p>
        <hr />

        @* PANEL DOCENTE *@
        @if (isDocente)
        {
            <div class="row g-3 mt-2 justify-content-center">
                <div class="col-12 col-sm-8 col-md-6">
                    <div class="card p-3">
                        <h5 class="mb-3">Panel de Docente</h5>
                        <div class="d-grid gap-2">
                            <a class="btn btn-primary" href="/Evaluaciones">Evaluaciones</a>
                            <a class="btn btn-secondary" href="/Historial">Historial Académico</a>
                            <a class="btn btn-outline-primary" href="/Cursos">Mis Cursos</a>
                            <a class="btn btn-outline-secondary" href="/Usuarios/Editar/@userId">Editar Perfil</a>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <h5>Accesos rápidos</h5>
            <div class="row g-3 mt-2">

                @* CURSOS *@
                @if ((isDocente || User.HasClaim("permiso", "Cursos.Ver") || isAdmin) && !isEstudiante)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 p-3 text-center">
                            <h6 class="mb-3">Cursos</h6>
                            <a class="btn btn-outline-primary w-100" href="/Cursos">Ir a Cursos</a>
                        </div>
                    </div>
                }

                @* HISTORIAL SEGÚN ROL *@
                @if (isDocente || isCoordinador || isAdmin)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 p-3 text-center">
                            <h6 class="mb-3">Historial</h6>
                            <a class="btn btn-outline-secondary w-100" href="/Historial">Ver Historial</a>
                        </div>
                    </div>
                }
                else if (isEstudiante)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 p-3 text-center">
                            <h6 class="mb-3">Mi Historial</h6>
                            <a class="btn btn-outline-secondary w-100" href="/MiHistorial">Ver mi historial</a>
                        </div>
                    </div>
                }

                @* USUARIOS *@
                @if (User?.HasClaim("permiso", "Usuarios.Gestion") ?? false)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 p-3 text-center">
                            <h6 class="mb-3">Usuarios</h6>
                            <a class="btn btn-outline-success w-100" href="/Usuarios">Gestionar Usuarios</a>
                        </div>
                    </div>
                }

                @* BITÁCORA *@
                @if (User?.HasClaim("permiso", "Bitacora.Ver") ?? false)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 p-3 text-center">
                            <h6 class="mb-3">Bitácora</h6>
                            <a class="btn btn-outline-dark w-100" href="/Bitacora">Ver Bitácora</a>
                        </div>
                    </div>
                }

                @* ESTADÍSTICAS *@
                @if (isDocente || isCoordinador || isAdmin)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 p-3 text-center">
                            <h6 class="mb-3">Estadísticas</h6>
                            <a class="btn btn-outline-primary w-100" href="/Estadisticas">Ir a Estadísticas</a>
                        </div>
                    </div>
                }

                @* MATRICULACIÓN *@
                @if (User.HasClaim("permiso", "Cursos.Crear") || isAdmin)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 p-3 text-center">
                            <h6 class="mb-3">Matriculación</h6>
                            <a class="btn btn-outline-primary w-100" href="/Matriculas/Crear">Matricular</a>
                        </div>
                    </div>
                }

                @* PERFIL *@
                <div class="col-6 col-md-3">
                    <div class="card h-100 p-3 text-center">
                        <h6 class="mb-3">Mi Perfil</h6>
                        <a class="btn btn-outline-secondary w-100" href="/Usuarios/Editar/@userId">Editar Perfil</a>
                    </div>
                </div>

            </div>
        }
    }
    else
    {
        <h1 class="display-5">Sistema de Gestión Escolar</h1>
        <p class="lead">Por favor inicie sesión para acceder a sus funcionalidades.</p>
        <a class="btn btn-primary" href="/Auth/Login">Iniciar Sesión</a>
    }
</div>
